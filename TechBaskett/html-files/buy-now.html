<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout - TechBaskett</title>
    <link rel="stylesheet" href="css-files/buy-now.css" />
        <link rel="stylesheet" href="css-files/nav-footer.css">

    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    
  </head>
  <body>
    <div class="main">
      <!-- Navigation Bar -->
      <div id="nav">
        <div id="nav_content">
          <div id="logo">
            <img
              src="Images/All YOUR TECH IN ONE BASKETT (1).png"
              alt="logo"
              height="50px"
              width="180px"
            />
          </div>

          <button id="menu-toggle">
            <i class="fas fa-bars"></i>
          </button>

          <div id="options">
            <button class="nav-btn"><a href="home.html">Home</a></button>
            <button class="nav-btn">
              <a href="All_products.html" target="_self">All Products</a>
            </button>
            <div class="dropdown">
              <button class="nav-btn" id="btn-drop">Categories</button>
              <div class="dropdown-content">
                <a href="Audio_products.html">Audio</a>
                <a href="Gaming_products.html">Gaming</a>
                <a href="Laptops.html">Laptops</a>
                <a href="Monitors.html">Monitors</a>
                <a href="Smart_wearables.html">Smart Wearables</a>
                <a href="Smartphones.html">Smartphones</a>
                <a href="Tablets.html">Tablets</a>
                <a href="TV.html">TVs</a>
              </div>
            </div>
            <button class="nav-btn"><a  href="contact.html">Contact</a></button>
          </div>
          <div id="icons">
            <a href="All_products.html"><i class="ri-search-line"></i></a>
            <a href="user-account.html"><i class="ri-user-line"></i></a>
            <a href="my-cart.html"><i class="ri-shopping-cart-line"></i></a>
          </div>
        </div>
      </div>

      <!-- Checkout Content -->
      <div class="checkout-container" id="checkoutContent">
        <!-- Content will be dynamically inserted here -->
        <div class="login-message">
          <p>Please login to proceed with your order</p>
          <a href="user-account.html" class="login-btn">Login</a>
        </div>
      </div>

      <!-- Footer -->
      <footer>
        <div class="footer-content">
          <div class="footer-section">
            <h3>About Us</h3>
            <p>
              Your one-stop shop for premium tech products. Quality gadgets,
              fast delivery, and excellent customer service.
            </p>
            <div class="social-icons">
              <a href="#"><i class="ri-facebook-circle-fill"></i></a>
              <a href="#"><i class="ri-twitter-x-line"></i></a>
              <a href="#"><i class="ri-instagram-line"></i></a>
              <a href="#"><i class="ri-linkedin-box-fill"></i></a>
            </div>
          </div>

          <div class="footer-section">
            <h3>Quick Links</h3>
            <a href="home.html">Home</a>
            <a href="All_products.html">Products</a>
            <a href="about.html">About Us</a>
            <a href="contact.html">Contact</a>
            <a href="blog.html">Blog</a>
          </div>

          <div class="footer-section">
            <h3>Customer Service</h3>
            <a href="#">FAQ</a>
            <a href="#">Shipping Policy</a>
            <a href="#">Return Policy</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms & Conditions</a>
          </div>

          <div class="footer-section">
            <h3>Contact Us</h3>
            <p>
              <i class="ri-map-pin-line"></i> 123 Tech Street, Silicon Valley
            </p>
            <p><i class="ri-phone-line"></i> +91 92896 79231</p>
            <p><i class="ri-mail-line"></i>&nbsp; support@techbaskett.com</p>
          </div>
        </div>

        <div class="copyright">
          <p>&copy; 2023 TechBaskett. All Rights Reserved.</p>
        </div>
      </footer>
    </div>

    <script src="js-files/products.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
        const checkoutContent = document.getElementById("checkoutContent");

        if (!loggedInUser) {
          return;
        }

        // Get cart from localStorage
        let cart = JSON.parse(localStorage.getItem("cart")) || {};
        const userCart = cart[loggedInUser.email] || [];

        if (userCart.length === 0) {
          checkoutContent.innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 100px 0;">
                        <h2>Your cart is empty</h2>
                        <p>Please add some products to proceed with checkout</p>
                        <a href="All_products.html" style="display: inline-block; margin-top: 20px; padding: 10px 20px; background: #096d9c; color: white; text-decoration: none; border-radius: 5px;">Continue Shopping</a>
                    </div>
                `;
          return;
        }

        // Calculate total
        let subtotal = 0;
        userCart.forEach((item) => {
          subtotal += item.price * item.quantity;
        });

        // Shipping (free for orders over ₹5000)
        const shipping = subtotal > 5000 ? 0 : 100;
        const total = subtotal + shipping;

        // Render checkout form
        checkoutContent.innerHTML = `
                <div class="checkout-form">
                    <div class="form-section">
                        <h3 class="section-title">Shipping Information</h3>
                        <div class="form-group">
                            <label for="fullName">Full Name</label>
                            <input type="text" id="fullName" value="${
                              loggedInUser.name
                            }" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" value="${
                              loggedInUser.email
                            }" readonly>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" value="${
                              loggedInUser.phone || ""
                            }" required>
                        </div>
                        <div class="form-group">
                            <label for="address">Shipping Address</label>
                            <textarea id="address" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" required>
                        </div>
                        <div class="form-group">
                            <label for="state">State</label>
                            <input type="text" id="state" required>
                        </div>
                        <div class="form-group">
                            <label for="zip">ZIP Code</label>
                            <input type="text" id="zip" required>
                        </div>
                    </div>
                    
                    <div class="form-section">
    <h3 class="section-title">Payment Method</h3>
    
    <div class="payment-method" id="creditCardMethod">
        <label>
            <input type="radio" name="payment" value="credit" checked>
            <i class="ri-bank-card-line payment-method-icon"></i>
            Credit/Debit Card
        </label>
        <div class="payment-details active" id="creditCardDetails">
            <div class="form-group">
                <label for="cardNumber">Card Number</label>
                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456">
            </div>
            <div class="form-group">
                <label for="cardName">Name on Card</label>
                <input type="text" id="cardName" placeholder="John Doe">
            </div>
            <div class="form-group" style="display: flex; gap: 15px;">
                <div style="flex: 1;">
                    <label for="expiryDate">Expiry Date</label>
                    <input type="text" id="expiryDate" placeholder="MM/YY">
                </div>
                <div style="flex: 1;">
                    <label for="cvv">CVV</label>
                    <input type="text" id="cvv" placeholder="123">
                </div>
            </div>
        </div>
    </div>
    
    <div class="payment-method" id="upiMethod">
        <label>
            <input type="radio" name="payment" value="upi">
            <i class="ri-wallet-line payment-method-icon"></i>
            UPI
        </label>
        <div class="payment-details" id="upiDetails">
            <div class="form-group">
                <label for="upiId">UPI ID</label>
                <input type="text" id="upiId" placeholder="yourname@upi">
            </div>
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
                You'll be redirected to your UPI app for payment confirmation
            </p>
        </div>
    </div>
    
    <div class="payment-method" id="codMethod">
        <label>
            <input type="radio" name="payment" value="cod">
            <i class="ri-money-dollar-circle-line payment-method-icon"></i>
            Cash on Delivery
        </label>
        <div class="payment-details" id="codDetails">
            <p style="font-size: 14px; color: #666;">
                Pay in cash when your order is delivered. An additional ₹50 processing fee may apply.
            </p>
        </div>
    </div>
</div>
                </div>
                
                <div class="order-summary">
                    <h3 class="section-title">Order Summary</h3>
                    ${userCart
                      .map(
                        (item) => `
                        <div class="order-item">
                            <div class="order-item-image">
                                <img src="${item.image}" alt="${item.name}">
                            </div>
                            <div class="order-item-details">
                                <div class="order-item-title">${item.name}</div>
                                <div class="order-item-price">₹${item.price.toLocaleString(
                                  "en-IN"
                                )} × ${item.quantity}</div>
                            </div>
                        </div>
                    `
                      )
                      .join("")}
                    
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span>₹${subtotal.toLocaleString("en-IN")}</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping</span>
                        <span>${shipping === 0 ? "FREE" : "₹" + shipping}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-total">Total</span>
                        <span class="summary-total">₹${total.toLocaleString(
                          "en-IN"
                        )}</span>
                    </div>
                    <button class="place-order-btn" id="placeOrderBtn">Place Order</button>
                </div>
            `;

        // Add event listener for place order button
        document
          .getElementById("placeOrderBtn")
          .addEventListener("click", placeOrder);
      });

      // Payment method selection handler
      document.addEventListener("DOMContentLoaded", function () {
        const paymentMethods = document.querySelectorAll(".payment-method");

        paymentMethods.forEach((method) => {
          const radio = method.querySelector('input[type="radio"]');
          const details = method.querySelector(".payment-details");

          // Handle initial state
          if (radio.checked) {
            method.classList.add("selected");
            details.classList.add("active");
          }

          // Handle click on the entire payment method box
          method.addEventListener("click", (e) => {
            // Don't do anything if the click was directly on the radio input
            if (e.target.tagName !== "INPUT") {
              radio.checked = true;

              // Update all payment methods
              paymentMethods.forEach((m) => {
                m.classList.remove("selected");
                m.querySelector(".payment-details").classList.remove("active");
              });

              // Update selected method
              method.classList.add("selected");
              details.classList.add("active");
            }
          });
        });
      });

      function placeOrder() {
        const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
        if (!loggedInUser) return;

        // Validate form
        const fullName = document.getElementById("fullName").value;
        const phone = document.getElementById("phone").value;
        const address = document.getElementById("address").value;
        const city = document.getElementById("city").value;
        const state = document.getElementById("state").value;
        const zip = document.getElementById("zip").value;

        if (!fullName || !phone || !address || !city || !state || !zip) {
          alert("Please fill in all required fields");
          return;
        }

        // Get cart
        let cart = JSON.parse(localStorage.getItem("cart")) || {};
        const userCart = cart[loggedInUser.email] || [];

        if (userCart.length === 0) {
          alert("Your cart is empty");
          return;
        }

        // Calculate total
        let subtotal = 0;
        userCart.forEach((item) => {
          subtotal += item.price * item.quantity;
        });
        const shipping = subtotal > 5000 ? 0 : 100;
        const total = subtotal + shipping;

        // Create order
        const order = {
          id: Date.now(),
          date: new Date().toISOString(),
          items: userCart,
          shippingInfo: {
            name: fullName,
            phone: phone,
            address: address,
            city: city,
            state: state,
            zip: zip,
          },
          paymentMethod: document.querySelector('input[name="payment"]:checked')
            .value,
          subtotal: subtotal,
          shipping: shipping,
          total: total,
          status: "Processing",
        };

        // Save order
        let orders = JSON.parse(localStorage.getItem("orders")) || {};
        const userOrders = orders[loggedInUser.email] || [];
        userOrders.push(order);
        orders[loggedInUser.email] = userOrders;
        localStorage.setItem("orders", JSON.stringify(orders));

        // Clear cart
        cart[loggedInUser.email] = [];
        localStorage.setItem("cart", JSON.stringify(cart));

        // Redirect to order confirmation
        window.location.href = `order-confirm.html?orderId=${order.id}`;
      }
    </script>
  </body>
</html>
